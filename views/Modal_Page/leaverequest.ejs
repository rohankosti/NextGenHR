<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextGenHR - LeaveRequest Form</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f0f2f5;
        }

        .card {
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            border-radius: 20px 20px 0 0;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .btn-custom {
            background: #3b82f6;
            color: white;
            border-radius: 12px;
            padding: 10px 20px;
        }

        .btn-custom:hover {
            background: #2563eb;
            color: white;
        }
    </style>
</head>

<body>

    <div class="container mt-5">

        <div class="card mx-auto" style="max-width: 700px;">
            <div class="header">
                <h2>Leave Request Form</h2>
                <p>Submit your leave details below</p>
            </div>

            <div class="card-body">

                <form id="leaveForm">

                    <!-- Employee -->
                    <div class="mb-3">
                        <label class="form-label">Employee</label>
                        <select class="form-select" id="employee_id" name="employee_id">
                            <option value="">Select Employee</option>

                        </select>
                    </div>

                    <!-- Leave Type -->
                    <div class="mb-3">
                        <label class="form-label">Leave Type</label>
                        <select class="form-select" id="leave_type_id" name="leave_type_id">
                            <option value="">Select Leave Type</option>
                            <option value="Sick Leave">Sick Leave</option>
                            <option value="Casual Leave">Casual Leave</option>
                            <option value="Earned Leave">Earned Leave</option>
                            <option value="Maternity Leave">Maternity Leave</option>
                            <option value="Paternity Leave">Paternity Leave</option>
                            <option value="Bereavement Leave">Bereavement Leave</option>
                        </select>
                    </div>

                    <!-- From Date -->
                    <div class="mb-3">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control" id="from_date" name="from_date">
                    </div>

                    <!-- To Date -->
                    <div class="mb-3">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control" id="to_date" name="to_date">
                    </div>

                    <!-- Reason -->
                    <div class="mb-3">
                        <label class="form-label">Reason</label>
                        <textarea class="form-control" id="reason" name="reason" rows="3"></textarea>
                    </div>

                    <!-- Status -->
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="status" name="status">
                            <option value="Pending">Pending</option>
                            <!-- <option value="Approved">Approved</option>
                            <option value="Rejected">Rejected</option> -->
                        </select>
                    </div>

                    <!-- Approved By -->
                    <div class="mb-3">
                        <label class="form-label">Approved By</label>
                        <select class="form-select" id="approved_by" name="approved_by">
                            <option value="">Select Approver</option>
                            <option value="Mitesh Prjapati">Mitesh Prjapati</option>
                        </select>
                    </div>

                    <!-- BUTTONS ROW (Save + Close together) -->
                    <div class="col-12 mt-3 d-flex justify-content-center gap-3">

                        <!-- SAVE -->
                        <button type="reset" class="btn btn-custom px-4">
                            Reset
                        </button>

                        <!-- CLOSE -->
                        <button type="button" class="btn btn-outline-secondary px-4" onclick="window.history.back()">
                            Close
                        </button>

                    </div>


                </form>
                <div id="eroor" class="mt-2"></div>
            </div>
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>

        addEventListener("DOMContentLoaded", async (e) => {
            e.preventDefault();
            const res = await fetch("http://localhost:3000/getregisterdata")
            //   console.log(res);

            const dat = await res.json()
            //   console.log(dat);

            const select = document.getElementById("employee_id");
            dat.forEach(e => {
                const option = document.createElement("option");
                // option.value=e._id;
                // option.value = e.first_name + " " + e.last_name;
                option.textContent = e.first_name + e.last_name;
                select.appendChild(option);
            });


        })

        const leaveForm = document.getElementById("leaveForm");
        leaveForm.addEventListener("submit", async (e) => {
            try {
                e.preventDefault()
                let formdata = new FormData(leaveForm);
                // console.log(formdata);
                const obj = Object.fromEntries(formdata.entries());
                console.log(obj);

                const response = await fetch("http://localhost:3000/leaverequest", {
                    method: "POST",
                    headers: {
                        "content-type": "application/json",
                    },
                    body: JSON.stringify(obj)
                });
                // console.log(response);
                const data = await response.json();

                console.log(data);
                let eroor = document.getElementById("eroor");

                if (response.ok) {
                    // alert("Data Saved Succsesfully")
                    eroor.innerHTML = `<div class="alert alert-success">${data.msg}</div>`;
                    leaveForm.reset();
                    // window.location.href = "/WEB/leave_request.html";

                }
                else {
                    eroor.innerHTML = `<div class="alert alert-warning">Data Can't Stored</div>`;;
                }
            }
            catch (err) {
                console.error("Eroor in Your Side", err);

            }
        })
    </script>

</body>

</html>