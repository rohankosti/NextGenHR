<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Form</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f0f2f5;
        }

        .card {
            border-radius: 18px;
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.10);
        }

        .header {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            border-radius: 18px 18px 0 0;
            color: #fff;
            padding: 25px;
            text-align: center;
        }

        .btn-custom {
            background: #3b82f6;
            color: white;
            border-radius: 10px;
        }

        .btn-custom:hover {
            background: #2563eb;
        }
    </style>
</head>

<body>

    <div class="container mt-4">

        <div class="card mx-auto" style="max-width: 650px;"> <!-- Wider Form -->
            <div class="header">
                <h3 class="m-0">Attendance</h3>
                <small>Mark today's attendance</small>
            </div>

            <div class="card-body">

                <form id="attendanceForm">

                    <div class="row g-3">

                        <!-- Employee -->
                        <div class="col-12">
                            <label class="form-label">Employee</label>
                            <select class="form-select " name="employee_id">
                                <option value="none" selected disabled>Select Employee</option>
                            </select>
                        </div>

                        <!-- Date -->
                        <div class="col-md-6">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" name="date">
                        </div>

                        <!-- Status -->
                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status">
                                <option value="Present">Present</option>
                                <option value="Absent">Absent</option>
                                <option value="Leave">Leave</option>
                            </select>
                        </div>

                        <!-- Check In -->
                        <div class="col-md-6">
                            <label class="form-label">Check In</label>
                            <input type="time" class="form-control" name="check_in">
                        </div>

                        <!-- Check Out -->
                        <div class="col-md-6">
                            <label class="form-label">Check Out</label>
                            <input type="time" class="form-control" name="check_out">
                        </div>

                        <!-- Worked Hours -->
                        <div class="col-md-6">
                            <label class="form-label">Hours</label>
                            <input type="number" class="form-control" name="worked_hour" placeholder="e.g. 8">
                        </div>

                        <!-- Remarks -->
                        <div class="col-12">
                            <label class="form-label">Remarks</label>
                            <textarea class="form-control" name="remarks" rows="2"></textarea>
                        </div>

                        <!-- BUTTONS ROW (Save + Close together) -->
                        <div class="col-12 mt-3 d-flex justify-content-center gap-3">

                            <!-- SAVE -->
                            <button type="submit" class="btn btn-custom px-4">
                                Submit
                            </button>

                            <!-- CLOSE -->
                            <button type="button" class="btn btn-outline-secondary px-4"
                                onclick="window.history.back()">
                                Close
                            </button>

                        </div>


                    </div>

                    <div id="eroor"></div>
                </form>

            </div>
        </div>

    </div>


    <script>
        addEventListener("DOMContentLoaded", async (e) => {
            const res = await fetch("http://localhost:3000/getregisterdata")
            const data = await res.json()
            console.log(data);
            const select = document.querySelector('select[name="employee_id"]');
            data.forEach(e => {
                const option = document.createElement('option');
                option.value = e._id;
                option.textContent = e.first_name + " " + e.last_name;
                select.appendChild(option);
            });


        })
        const attendanceform = document.getElementById("attendanceForm")
        attendanceform.addEventListener("submit", async (e) => {
            try {
                e.preventDefault()
                const form = new FormData(attendanceForm)
                const obj = Object.fromEntries(form.entries());
                // console.log(eroor);


                const res = await fetch("http://localhost:3000/Attendancedata",
                    {
                        method: "POST",
                        headers: {
                            "content-type": "application/json"
                        },
                        body: JSON.stringify(obj)
                    })
                console.log(res);
                const data = await res.json()
                console.log(data);
                const eroor = document.getElementById("eroor");
                if (res.ok) {
                    eroor.innerHTML = `<div class="mt-2 alert alert-success">${data.msg}</div>`;
                    attendanceform.reset()
                }
                else {
                    eroor.innerHTML = `<div class="alert alert-danger">"Data Can't be Stored</div>`;
                }
            }
            catch (error) {
                console.error("Eroor In Your Side", error);
            }
        })
    </script>
</body>

</html>